# 报表查询功能使用说明

## 功能概述

报表查询功能是代理管理平台的重要组成部分，位于「会员管理」右侧的导航选项中。此功能提供全面的投注数据分析和报表生成能力，帮助代理高效管理和分析其业务数据。

## 主要功能特点

### 1. 多维度查询条件
- **时间范围筛选**：支援自定义日期范围和快速时间选项
- **游戏类型筛选**：支援各种游戏类型的组合筛选
- **结算状态筛选**：已结算、未结算、全部状态
- **投注类型筛选**：单号投注、组合投注
- **金额范围筛选**：最小金额至最大金额
- **用户筛选**：支援会员名或代理名搜索

### 2. 统计摘要显示
- **总投注笔数**：蓝色卡片显示投注总数
- **总投注金额**：天蓝色卡片显示投注总额
- **有效投注**：绿色卡片显示有效投注金额
- **盈亏结果**：动态颜色卡片（绿色盈利/红色亏损）

### 3. 详细报表数据
包含13个栏位的完整报表：
- 期号、用户名、游戏类型
- 投注内容、下注金额、有效金额
- 盈亏、退水、所属代理
- 占成、代理结果、上交、时间

### 4. 数据汇出功能
- 支援Excel格式报表汇出
- 自动生成包含时间范围的档案名称
- 保持与查询条件一致的数据筛选

## 使用方法

### 1. 进入报表查询页面
1. 登入代理管理平台
2. 点击导航选单中的「📊报表查询」选项
3. 系统自动载入今日报表数据

### 2. 设定查询条件

#### 时间范围设定
- **手动设定**：选择开始日期和结束日期
- **快速选项**：
  - 今日：当天数据
  - 昨日：前一天数据
  - 本周：本周一至今日
  - 本月：本月1日至今日

#### 游戏类型筛选
- 全选：包含所有游戏类型
- 个别选择：
  - AR PK10
  - AR 时时彩
  - AR 539
  - AR 六合彩
  - 其他游戏

#### 结算状态筛选
- 全部：所有投注记录
- 已结算：已开奖结算的投注
- 未结算：等待开奖的投注

#### 投注类型筛选
- 全部：所有投注类型
- 单号投注：单一号码投注
- 组合投注：多号码组合投注

#### 金额范围筛选
- 输入最小金额和最大金额
- 留空表示不限制该范围

#### 用户筛选
- 输入会员用户名或代理用户名
- 支援模糊搜索

### 3. 执行查询
1. 设定完查询条件后，点击「🔍查询」按钮
2. 系统自动更新统计摘要和报表数据
3. 可使用「🔄刷新」按钮重新载入数据

### 4. 汇出报表
1. 点击「📥汇出报表」按钮
2. 系统生成Excel档案并自动下载
3. 档案名格式：`报表_开始日期_结束日期.xlsx`

## 界面设计说明

### 1. 页面布局
- **顶部操作区**：标题和汇出、查询按钮
- **查询条件区**：折叠式查询表单
- **统计摘要区**：四个统计卡片
- **报表数据区**：详细数据表格

### 2. 颜色设计
- **主色调**：蓝色系（Bootstrap primary）
- **统计卡片**：
  - 投注笔数：蓝色 (bg-primary)
  - 投注金额：天蓝色 (bg-info)
  - 有效投注：绿色 (bg-success)
  - 盈亏结果：动态（绿色盈利/红色亏损）

### 3. 图标设计
- 📊 报表查询：主功能图标
- 🔍 查询：搜索功能
- 📥 汇出报表：下载功能
- 🔄 刷新：重新载入
- 📅 日历：时间选择
- 🎮 游戏：游戏类型

## 数据格式说明

### 1. 金额显示
- 格式：$X,XXX.XX
- 盈利：+$X,XXX.XX（绿色）
- 亏损：-$X,XXX.XX（红色）

### 2. 百分比显示
- 格式：XX.X%
- 用于退水比例和占成显示

### 3. 日期时间格式
- 日期：YYYY-MM-DD
- 时间：YYYY-MM-DD HH:mm:ss

### 4. 投注内容格式
- 位置投注：位置投注: 大小单双
- 号码投注：号码投注: 1, 5, 8
- 其他类型：根据具体投注内容显示

## 后端API需求

### 1. 查询API端点
```
GET /api/agent/reports
```

### 2. 查询参数
- startDate: 开始日期
- endDate: 结束日期
- gameTypes: 游戏类型（逗号分隔）
- settlementStatus: 结算状态
- betType: 投注类型
- minAmount: 最小金额
- maxAmount: 最大金额
- username: 用户名

### 3. 汇出API端点
```
GET /api/agent/reports/export
```

### 4. 回应数据格式
```javascript
{
  totalBets: 总投注笔数,
  totalAmount: 总投注金额,
  validAmount: 有效投注金额,
  profitLoss: 盈亏结果,
  records: [
    {
      id: 记录ID,
      period: 期号,
      username: 用户名,
      game_type: 游戏类型,
      bet_content: 投注内容,
      amount: 下注金额,
      valid_amount: 有效金额,
      profit_loss: 盈亏,
      rebate: 退水,
      agent_name: 所属代理,
      commission_rate: 占成比例,
      agent_result: 代理结果,
      upper_transfer: 上交金额,
      created_at: 创建时间
    }
  ]
}
```

## 注意事项

### 1. 权限控制
- 代理只能查看自己管理范围内的数据
- 下级代理和会员的投注记录
- 总代理可查看所有数据

### 2. 性能优化
- 大数据量查询可能需要较长时间
- 建议使用适当的时间范围筛选
- 避免查询过大的日期范围

### 3. 数据准确性
- 统计数据基于实时资料库
- 未结算投注的盈亏为预估值
- 最终数据以结算后为准

### 4. 汇出限制
- 单次汇出建议不超过10万笔记录
- 大量数据可分批汇出
- 汇出档案建议定期清理

## 疑难排解

### 1. 查询无结果
- 检查时间范围是否正确
- 确认筛选条件是否过于严格
- 验证用户名拼写是否正确

### 2. 汇出失败
- 检查网路连接状态
- 确认数据量是否过大
- 尝试缩小查询范围

### 3. 数据显示异常
- 刷新页面重新载入
- 检查登入状态是否有效
- 联系技术支援

## 更新日志

### 版本 1.0 (2025-06-27)
- 初始版本发布
- 完整的查询和筛选功能
- 统计摘要和详细报表
- Excel汇出功能
- 响应式界面设计

---

**技术支援**：如遇任何问题，请联系系统管理员或技术支援团队。 