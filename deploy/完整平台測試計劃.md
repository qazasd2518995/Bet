# 🧪 完整平台测试计划

## 测试环境
- **游戏平台**: https://bet-game-vcje.onrender.com
- **代理平台**: https://bet-agent.onrender.com
- **资料库**: PostgreSQL (Render部署)

## 测试账号准备

### 总代理账号
- **A盘总代理**: ti2025A (退水上限: 1.1%)
- **D盘总代理**: ti2025D (退水上限: 4.1%)

## 📋 测试项目清单

### ✅ 测试1: 创建15层代理结构
**目标**: 验证代理层级创建功能和层级限制

**A盘代理结构**:
```
ti2025A (L1, 1.1%)
  └── agentA2_xxx (L2, 1.05%, 比例模式)
      └── agentA3_xxx (L3, 0.99%, 全拿模式)
          └── agentA4_xxx (L4, 0.94%, 比例模式)
              └── ... 继续到 L15
```

**D盘代理结构**:
```
ti2025D (L1, 4.1%)
  └── agentD2_xxx (L2, 3.90%, 比例模式)
      └── agentD3_xxx (L3, 3.69%, 全拿模式)
          └── agentD4_xxx (L4, 3.49%, 比例模式)
              └── ... 继续到 L15
```

**验证点**:
- ✓ 每层代理成功创建
- ✓ 退水比例逐层递减
- ✓ 退水模式正确设置
- ✓ 第16层无法创建（达到限制）

### ✅ 测试2: 创建会员功能
**目标**: 验证不同层级代理创建会员的功能

**测试会员**:
- L2代理的会员 × 2
- L6代理的会员 × 2
- L15代理的会员 × 2

**验证点**:
- ✓ 会员继承代理的盘口类型
- ✓ 会员退水比例正确设置
- ✓ 会员与代理关联正确

### ✅ 测试3: 登入测试
**目标**: 验证所有账号可以正常登入

**测试内容**:
1. 代理登入代理平台
2. 会员登入游戏平台
3. 错误密码测试
4. 跨平台登入限制

### ✅ 测试4-5: 下注和赔率测试
**目标**: 验证不同盘口的赔率差异和下注功能

**A盘预期赔率**:
- 号码: 9.89
- 两面: 1.9

**D盘预期赔率**:
- 号码: 9.59
- 两面: 1.88

**测试下注类型**:
1. 冠军大/小
2. 亚军单/双
3. 号码投注
4. 龙虎对战
5. 冠亚和值

### ✅ 测试6: 退水计算验证
**目标**: 验证退水按照我们修复的逻辑正确计算

**测试案例**:
- A盘L2代理(1.05%)的会员下注100元 → 退水1.05元
- D盘L6代理(3.28%)的会员下注200元 → 退水6.56元

**验证点**:
- ✓ 退水金额 = 下注金额 × 代理设置的退水比例
- ✓ 不再是错误的乘法运算
- ✓ 退水正确分配给代理

### ✅ 测试7: 代理仪表板
**目标**: 验证仪表板数据准确性

**检查项目**:
- 会员总数
- 下级代理数
- 今日投注额
- 今日盈亏
- 总余额
- 实时数据更新

### ✅ 测试8: 登录日志
**目标**: 验证登录日志记录功能

**测试内容**:
- 登录时间记录
- IP地址记录
- 设备信息记录
- 登录状态（成功/失败）

### ✅ 测试9: 报表查询
**目标**: 验证报表数据完整性和准确性

**测试报表**:
1. 代理层级分析
2. 会员输赢报表
3. 交易明细报表
4. 盈亏统计报表

**验证点**:
- ✓ 所有下注记录都出现在报表中
- ✓ 金额计算正确
- ✓ 退水显示正确

### ✅ 测试10: 交易记录
**目标**: 测试各种交易类型的记录

**测试交易类型**:
1. **存款测试**: 代理给会员存款
2. **提款测试**: 会员向代理提款
3. **退水记录**: 自动退水分配
4. **点数转移**: 代理间转账

### ✅ 测试11: 下注记录
**目标**: 验证下注记录的完整性

**检查内容**:
- 下注时间
- 下注类型和金额
- 赔率记录
- 开奖结果
- 输赢金额
- 退水金额

### ✅ 测试12: 客服功能
**目标**: 测试客服调整余额功能

**测试内容**:
1. 客服给代理加钱
2. 客服给会员加钱
3. 客服扣减余额
4. 交易记录生成

### ✅ 测试13: 隐私性测试
**目标**: 验证数据隔离和权限控制

**测试场景**:
1. **L5代理登入**:
   - ✓ 能看到L6-L15的下级代理
   - ✗ 不能看到L1-L4的上级代理
   - ✓ 只能看到自己线下的会员

2. **跨线检查**:
   - ✗ A盘代理看不到D盘数据
   - ✗ 不同线的代理互相看不到

3. **数据权限**:
   - ✗ 不能修改上级代理数据
   - ✓ 只能管理自己的下级

## 📊 预期测试结果

### 数据统计
- A盘代理: 14个（L2-L15）
- D盘代理: 14个（L2-L15）
- A盘会员: 6个
- D盘会员: 6个
- 总下注数: 约30-40笔
- 交易记录: 约20-30笔

### 关键验证点
1. **退水机制**: 确认按照代理设置比例直接计算
2. **赔率差异**: A盘高赔率 vs D盘标准赔率
3. **层级限制**: 最多15层代理
4. **数据隔离**: 不同线路数据完全隔离

## 🚀 执行测试

运行测试脚本：
```bash
node run-comprehensive-test.js
```

测试将自动执行所有13个测试项目，并生成详细的测试报告。

## ⚠️ 注意事项

1. 测试前确保平台正常运行
2. 准备好总代理的登入凭证
3. 测试会创建大量测试数据
4. 建议在测试环境执行，避免影响生产数据
5. 测试完成后可能需要清理测试数据 