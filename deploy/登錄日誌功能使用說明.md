# 登录日志功能使用说明

## 功能概述

登录日志功能提供完整的用户登录记录查询和管理，包含详细的时间、IP地址和地理位置信息，帮助代理监控下级帐号的登录活动。

## 功能特点

- **智能时间筛选**：支援自定义日期范围和快速选项（今日/昨日/本周/最近7天）
- **多维度查询**：按用户名、时间范围、IP地址等条件筛选
- **详细记录**：显示登录时间、IP地址、地理位置、用户类型等信息
- **数据保留**：最少保留7天，超过7天部分保留最后20笔记录
- **分页显示**：支援大量数据的分页浏览
- **实时刷新**：支援手动刷新获取最新登录记录

## 界面组成

### 1. 导航选项
- 位置：仪表板选单右侧
- 图标：📊 登录日志
- 功能：点击进入登录日志管理页面

### 2. 时间范围选择器
```
请选择起止时间
├── 开始时间（日期选择器）
├── 结束时间（日期选择器）  
├── 用户筛选（搜索框）
└── 快速选项（今日/昨日/本周/最近7天）
```

### 3. 登录记录表格
包含以下栏位：
- **NO.**：序号
- **用户名**：登录的用户帐号
- **登录时间**：具体的登录日期和时间
- **IP**：登录的IP地址
- **IP归属地**：IP地址的地理位置信息

## 使用方法

### 基本查询
1. 进入「登录日志」页面
2. 系统自动载入最近7天的登录记录
3. 查看用户登录活动详情

### 自定义时间查询
1. 设定「开始时间」和「结束时间」
2. 点击「搜索」按钮或按Enter键
3. 系统显示指定时间范围内的登录记录

### 快速时间筛选
- **今日**：查看今天的登录记录
- **昨日**：查看昨天的登录记录
- **本周**：查看本周的登录记录
- **最近7天**：查看最近7天的登录记录

### 用户筛选
1. 在「用户筛选」输入框中输入用户名
2. 支援模糊搜索
3. 点击搜索按钮查看特定用户的登录记录

### 数据刷新
- 点击「🔄 刷新日志」按钮
- 获取最新的登录记录
- 保持数据同步

## 界面设计

### 页面标题
```
📊 登录日志                                    🔄 刷新日志
```

### 筛选卡片
```
📅 请选择起止时间
┌─────────────────────────────────────────────────────────┐
│ 开始时间: [____] 结束时间: [____] 用户筛选: [____] [🔍]  │
│ [今日] [昨日] [本周] [最近7天]                          │
└─────────────────────────────────────────────────────────┘
```

### 记录表格
```
📋 登录记录                                       共 X 笔记录
┌────┬──────────┬─────────────────┬───────────────┬─────────────┐
│NO. │ 用户名    │ 登录时间         │ IP            │ IP归属地    │
├────┼──────────┼─────────────────┼───────────────┼─────────────┤
│ 1  │ ttpp123  │ 2025-06-27      │ 123.193.88.143│ 台湾省台北市│
│    │ 👤 会员   │ 10:14:10        │               │ 亚太电信... │
└────┴──────────┴─────────────────┴───────────────┴─────────────┘
```

### 分页控制
```
显示第 1 - 20 笔，共 X 笔记录      ◀ [1] [2] [3] ... ▶
```

## 数据格式

### 登录记录字段
```javascript
{
    id: 1,                           // 记录ID
    username: "ttpp123",             // 用户名
    user_type: "member",             // 用户类型（member/agent/admin）
    login_time: "2025-06-27 10:14:10", // 登录时间
    ip_address: "123.193.88.143",    // IP地址
    ip_location: "台湾省台北市 亚太电信集团公司" // IP归属地
}
```

### 用户类型标识
- **会员**：蓝色标签
- **代理**：绿色标签  
- **管理员**：红色标签

## 后端API需求

### 1. 登录日志查询API
```
GET /api/agent/login-logs
```

**请求参数：**
```javascript
{
    startDate: "2025-01-01",     // 开始日期
    endDate: "2025-01-31",       // 结束日期
    username: "ttpp123"          // 用户名（可选）
}
```

**响应格式：**
```javascript
{
    "success": true,
    "logs": [
        {
            "id": 1,
            "username": "ttpp123",
            "user_type": "member",
            "login_time": "2025-06-27 10:14:10",
            "ip_address": "123.193.88.143",
            "ip_location": "台湾省台北市 亚太电信集团公司"
        }
    ],
    "total": 100
}
```

### 2. 数据保留策略
- 最少保留7天的完整记录
- 超过7天的记录最多保留最后20笔
- 实施自动清理机制

## 安全性考量

### 1. 权限控制
- 代理只能查看下级代理和会员的登录记录
- 会员无法查看登录日志
- 总代理可以查看所有记录

### 2. 数据隐私
- IP地址显示需要适当权限
- 地理位置信息脱敏处理
- 敏感数据加密存储

### 3. 异常检测
- 异常IP登录提醒
- 多地点同时登录警告
- 频繁登录行为监控

## 注意事项

1. **数据保留期限**：登录日志最少被保留7天，超过7天部分最多保留最后20笔
2. **查询范围限制**：单次查询最多支援31天范围
3. **性能考量**：大量数据查询可能需要稍等片刻
4. **时区问题**：所有时间以系统时区为准
5. **权限限制**：只能查看有权限的用户登录记录

## 疑难排解

### 常见问题

**Q: 为什么看不到某些用户的登录记录？**
A: 检查用户权限，只能查看下级代理和会员的记录。

**Q: 登录时间显示不正确？**
A: 确认系统时区设定，时间以伺服器时区为准。

**Q: IP归属地显示「未知位置」？**
A: 可能是内网IP或IP库未包含该地址。

**Q: 搜索结果为空？**
A: 检查时间范围和用户名拼写，确认该期间内有登录活动。

### 技术支援

如遇到功能问题，请联系技术支援并提供：
1. 具体的错误讯息
2. 操作步骤描述
3. 查询的时间范围
4. 用户权限等级

---

*登录日志功能为代理管理系统的重要安全监控工具，请合理使用并遵守相关法规。* 