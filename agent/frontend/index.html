<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代理管理系統</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="./css/main.css">
    <style>
        /* 基本樣式 */
        body {
            font-family: 'Microsoft JhengHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #f8f9fa;
        }
        /* ... 其他現有樣式 ... */

        /* 添加球號顏色規則 */
        .number-ball {
            width: 28px; /* 根據需要調整大小 */
            height: 28px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px; /* 根據需要調整大小 */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            margin: 0 2px; /* 添加一些間距 */
            color: #fff; /* 預設文字顏色 */
        }

        /* 與遊戲前端一致的顏色 */
        .color-1 { background-color: #ffcc00; color: #000; } /* 金黃色 */
        .color-2 { background-color: #3399ff; color: #fff; } /* 鮮藍色 */
        .color-3 { background-color: #777777; color: #fff; } /* 深灰色 */
        .color-4 { background-color: #ff9933; color: #fff; } /* 橙色 */
        .color-5 { background-color: #00ccff; color: #fff; } /* 天藍色 */
        .color-6 { background-color: #9966cc; color: #fff; } /* 紫色 */
        .color-7 { background-color: #aaaaaa; color: #fff; } /* 灰色 */
        .color-8 { background-color: #ff3333; color: #fff; } /* 紅色 */
        .color-9 { background-color: #990000; color: #fff; } /* 深紅色 */
        .color-10 { background-color: #33cc33; color: #fff; } /* 綠色 */
    </style>
</head>
<body>
    <div id="app">
        <!-- 登入頁面 -->
        <div v-if="!isLoggedIn" class="container login-container">
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-5">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <h3 class="text-center mb-0">代理管理系統</h3>
                        </div>
                        <div class="card-body">
                            <form @submit.prevent="login">
                                <div class="form-group mb-3">
                                    <label for="username">用戶名</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                                        <input type="text" id="username" v-model="loginForm.username" class="form-control" placeholder="請輸入用戶名" required>
                                    </div>
                                </div>
                                <div class="form-group mb-3">
                                    <label for="password">密碼</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                        <input type="password" id="password" v-model="loginForm.password" class="form-control" placeholder="請輸入密碼" required>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="remember">
                                        <label class="form-check-label" for="remember">記住我</label>
                                    </div>
                                    <button type="submit" class="btn btn-primary" :disabled="loading">
                                        <span v-if="loading" class="spinner-border spinner-border-sm" role="status"></span>
                                        登入
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主頁面 -->
        <div v-else>
            <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">代理管理系統</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" :class="{active: activeTab === 'dashboard'}" href="#" @click="activeTab = 'dashboard'">儀表板</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" :class="{active: activeTab === 'agents'}" href="#" @click="activeTab = 'agents'">代理管理</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" :class="{active: activeTab === 'members'}" href="#" @click="activeTab = 'members'">會員管理</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" :class="{active: activeTab === 'transactions'}" href="#" @click="activeTab = 'transactions'">交易記錄</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" :class="{active: activeTab === 'stats'}" href="#" @click="activeTab = 'stats'">下注記錄</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" :class="{active: activeTab === 'draw'}" href="#" @click="activeTab = 'draw'">開獎記錄</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" :class="{active: activeTab === 'notices'}" href="#" @click="activeTab = 'notices'">系統公告</a>
                            </li>
                        </ul>
                        <ul class="navbar-nav ms-auto">
                            <li class="nav-item me-3">
                                <a class="nav-link">
                                    <i class="fas fa-wallet me-1"></i>額度: {{ formatMoney(user.balance) }}
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-user-circle me-1"></i>{{ user.username }}
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#" @click="activeTab = 'profile'">個人資料</a></li>
                                    <li><a class="dropdown-item" href="#" @click="activeTab = 'settings'">帳號設置</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" @click="logout">登出</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <div class="container-fluid mt-3">
                <!-- 儀表板 -->
                <div v-if="activeTab === 'dashboard'">
                    <h2>儀表板</h2>
                    <div class="row mt-4">
                        <div class="col-md-3 mb-4">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <h5 class="card-title">我的點數餘額</h5>
                                    <h2 class="card-text">{{ formatMoney(user.balance) }}</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <h5 class="card-title">總會員數</h5>
                                    <h2 class="card-text">{{ dashboardData.totalMembers }}</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <h5 class="card-title">今日交易量</h5>
                                    <h2 class="card-text">{{ formatMoney(dashboardData.todayTransactions) }}</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card bg-warning text-white">
                                <div class="card-body">
                                    <h5 class="card-title">本月佣金</h5>
                                    <h2 class="card-text">{{ formatMoney(dashboardData.monthlyCommission) }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-8 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    近期交易趨勢
                                </div>
                                <div class="card-body">
                                    <canvas id="transactionChart" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    系統公告
                                </div>
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li v-for="notice in notices" :key="notice.id" class="list-group-item d-flex justify-content-between align-items-center">
                                            <span>{{ notice.title }}</span>
                                            <span class="badge bg-primary rounded-pill">{{ formatDate(notice.createTime) }}</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- API連接測試卡片 -->
                            <div class="card mt-3">
                                <div class="card-header bg-info text-white">
                                    系統狀態
                                </div>
                                <div class="card-body">
                                    <div class="d-grid">
                                        <button class="btn btn-primary" @click="checkApiStatus">
                                            <i class="fas fa-sync-alt me-1"></i>測試API連接
                                        </button>
                                        <div class="mt-2 text-muted small">
                                            <strong>當前API地址:</strong> {{ API_BASE_URL }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 代理管理 -->
                <div v-if="activeTab === 'agents'">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>代理管理</h2>
                        <button class="btn btn-primary" @click="showAgentModal">
                            <i class="fas fa-plus me-1"></i>新增代理
                        </button>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            搜尋條件
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">代理級別</label>
                                    <select class="form-select" v-model="agentFilters.level">
                                        <option value="-1">全部</option>
                                        <option value="0">總代理</option>
                                        <option value="1">一級代理</option>
                                        <option value="2">二級代理</option>
                                        <option value="3">三級代理</option>
                                        <option value="4">四級代理</option>
                                        <option value="5">五級代理</option>
                                        <option value="6">六級代理</option>
                                        <option value="7">七級代理</option>
                                        <option value="8">八級代理</option>
                                        <option value="9">九級代理</option>
                                        <option value="10">十級代理</option>
                                        <option value="11">十一級代理</option>
                                        <option value="12">十二級代理</option>
                                        <option value="13">十三級代理</option>
                                        <option value="14">十四級代理</option>
                                        <option value="15">十五級代理</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">狀態</label>
                                    <select class="form-select" v-model="agentFilters.status">
                                        <option value="-1">全部</option>
                                        <option value="1">啟用</option>
                                        <option value="0">停用</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">關鍵字</label>
                                    <input type="text" class="form-control" placeholder="用戶名/ID" v-model="agentFilters.keyword">
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button class="btn btn-primary w-100" @click="searchAgents">搜尋</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用戶名</th>
                                            <th>級別</th>
                                            <th>上級</th>
                                            <th>餘額</th>
                                            <th>佣金比例</th>
                                            <th>創建時間</th>
                                            <th>狀態</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="agent in agents" :key="agent.id">
                                            <td>{{ agent.id }}</td>
                                            <td>{{ agent.username }}</td>
                                            <td>{{ getLevelName(agent.level) }}</td>
                                            <td>{{ agent.parent || '-' }}</td>
                                            <td>{{ formatMoney(agent.balance) }}</td>
                                            <td>{{ (agent.commission * 100) + '%' }}</td>
                                            <td>{{ formatDate(agent.createdAt) }}</td>
                                            <td>
                                                <span :class="agent.status === 1 ? 'badge bg-success' : 'badge bg-danger'">
                                                    {{ agent.status === 1 ? '啟用' : '停用' }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="btn-group">
                                                    <button class="btn btn-sm btn-outline-info" @click="viewAgentDetails(agent)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-primary" @click="editAgent(agent)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-danger" @click="toggleAgentStatus(agent)">
                                                        <i :class="agent.status === 1 ? 'fas fa-ban' : 'fas fa-check'"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <nav v-if="agentPagination.totalPages > 1">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item" :class="{disabled: agentPagination.currentPage === 1}">
                                        <a class="page-link" href="#" @click.prevent="changePage(agentPagination.currentPage - 1, 'agents')">上一頁</a>
                                    </li>
                                    <li class="page-item" v-for="page in agentPagination.totalPages" :key="page" :class="{active: page === agentPagination.currentPage}">
                                        <a class="page-link" href="#" @click.prevent="changePage(page, 'agents')">{{ page }}</a>
                                    </li>
                                    <li class="page-item" :class="{disabled: agentPagination.currentPage === agentPagination.totalPages}">
                                        <a class="page-link" href="#" @click.prevent="changePage(agentPagination.currentPage + 1, 'agents')">下一頁</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>

                    <!-- 新增代理 Modal -->
                    <div class="modal" id="createAgentModal" tabindex="-1" v-if="showCreateAgentModal">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">新增代理</h5>
                                    <button type="button" class="btn-close" @click="hideCreateAgentModal"></button>
                                </div>
                                <div class="modal-body">
                                    <form @submit.prevent="createAgent">
                                        <div class="mb-3">
                                            <label class="form-label">用戶名</label>
                                            <input type="text" class="form-control" v-model="newAgent.username" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">密碼</label>
                                            <input type="password" class="form-control" v-model="newAgent.password" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">代理級別</label>
                                            <select class="form-select" v-model="newAgent.level" required>
                                                <option value="0">總代理</option>
                                                <option value="1">一級代理</option>
                                                <option value="2">二級代理</option>
                                                <option value="3">三級代理</option>
                                                <option value="4">四級代理</option>
                                                <option value="5">五級代理</option>
                                                <option value="6">六級代理</option>
                                                <option value="7">七級代理</option>
                                                <option value="8">八級代理</option>
                                                <option value="9">九級代理</option>
                                                <option value="10">十級代理</option>
                                                <option value="11">十一級代理</option>
                                                <option value="12">十二級代理</option>
                                                <option value="13">十三級代理</option>
                                                <option value="14">十四級代理</option>
                                                <option value="15">十五級代理</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">上級代理</label>
                                            <select class="form-select" v-model="newAgent.parent">
                                                <option value="">無</option>
                                                <option v-for="agent in parentAgents" :key="agent.id" :value="agent.id">
                                                    {{ agent.username }} ({{ agent.id }})
                                                </option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">佣金比例</label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" v-model="newAgent.commission" step="0.01" min="0" max="1" required>
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <button type="button" class="btn btn-secondary me-2" @click="hideCreateAgentModal">取消</button>
                                            <button type="submit" class="btn btn-primary" :disabled="loading">
                                                <span v-if="loading" class="spinner-border spinner-border-sm" role="status"></span>
                                                建立
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 編輯代理 Modal -->
                    <div class="modal" id="editAgentModal" tabindex="-1" v-if="showEditAgentModal">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">編輯代理</h5>
                                    <button type="button" class="btn-close" @click="hideEditAgentModal"></button>
                                </div>
                                <div class="modal-body">
                                    <form @submit.prevent="updateAgent">
                                        <div class="mb-3">
                                            <label class="form-label">代理ID</label>
                                            <input type="text" class="form-control" v-model="editAgentData.id" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">用戶名</label>
                                            <input type="text" class="form-control" v-model="editAgentData.username" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">修改密碼 (留空表示不修改)</label>
                                            <input type="password" class="form-control" v-model="editAgentData.password">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">佣金比例</label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" v-model="editAgentData.commission" step="0.01" min="0" max="1" required>
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">狀態</label>
                                            <select class="form-select" v-model="editAgentData.status">
                                                <option value="1">啟用</option>
                                                <option value="0">停用</option>
                                            </select>
                                        </div>
                                        <div class="text-end">
                                            <button type="button" class="btn btn-secondary me-2" @click="hideEditAgentModal">取消</button>
                                            <button type="submit" class="btn btn-primary" :disabled="loading">
                                                <span v-if="loading" class="spinner-border spinner-border-sm" role="status"></span>
                                                更新
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 會員管理 -->
                <div v-if="activeTab === 'members'">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>會員管理</h2>
                        <button class="btn btn-primary" @click="showMemberModal">
                            <i class="fas fa-plus me-1"></i>新增會員
                        </button>
                    </div>

                    <div class="card mb-4">
                        <div class="card-header">
                            搜尋條件
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">狀態</label>
                                    <select class="form-select" v-model="memberFilters.status">
                                        <option value="-1">全部</option>
                                        <option value="1">啟用</option>
                                        <option value="0">停用</option>
                                    </select>
                                </div>
                                <div class="col-md-5">
                                    <label class="form-label">關鍵字</label>
                                    <input type="text" class="form-control" placeholder="用戶名/ID" v-model="memberFilters.keyword">
                                </div>
                                <div class="col-md-4 d-flex align-items-end">
                                    <button class="btn btn-primary" @click="searchMembers">搜尋</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover align-middle">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用戶名</th>
                                            <th>餘額</th>
                                            <th>狀態</th>
                                            <th>創建時間</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-if="members.length === 0">
                                            <td colspan="6" class="text-center">無會員數據</td>
                                        </tr>
                                        <tr v-for="member in members" :key="member.id">
                                            <td>{{ member.id }}</td>
                                            <td>{{ member.username }}</td>
                                            <td>{{ formatMoney(member.balance) }}</td>
                                            <td>
                                                <span class="badge" :class="member.status === 1 ? 'bg-success' : 'bg-danger'">
                                                    {{ member.status === 1 ? '啟用' : '停用' }}
                                                </span>
                                            </td>
                                            <td>{{ formatDate(member.created_at) }}</td>
                                            <td>
                                                <div class="btn-group">
                                                    <button class="btn btn-sm btn-outline-primary" @click="adjustMemberBalance(member)">
                                                        <i class="fas fa-exchange-alt me-1"></i>點數轉移
                                                    </button>
                                                    <button class="btn btn-sm" :class="member.status === 1 ? 'btn-outline-danger' : 'btn-outline-success'" 
                                                            @click="toggleMemberStatus(member.id, member.status)">
                                                        <i class="fas" :class="member.status === 1 ? 'fa-ban' : 'fa-check'"></i>
                                                        {{ member.status === 1 ? '停用' : '啟用' }}
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <nav v-if="memberPagination.totalPages > 1">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item" :class="{disabled: memberPagination.currentPage === 1}">
                                        <a class="page-link" href="#" @click.prevent="changePage(memberPagination.currentPage - 1, 'members')">上一頁</a>
                                    </li>
                                    <li class="page-item" v-for="page in memberPagination.totalPages" :key="page" :class="{active: page === memberPagination.currentPage}">
                                        <a class="page-link" href="#" @click.prevent="changePage(page, 'members')">{{ page }}</a>
                                    </li>
                                    <li class="page-item" :class="{disabled: memberPagination.currentPage === memberPagination.totalPages}">
                                        <a class="page-link" href="#" @click.prevent="changePage(memberPagination.currentPage + 1, 'members')">下一頁</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>

                    <!-- 新增會員 Modal -->
                    <div class="modal" id="createMemberModal" tabindex="-1" v-if="showCreateMemberModal">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">新增會員</h5>
                                    <button type="button" class="btn-close" @click="hideCreateMemberModal"></button>
                                </div>
                                <div class="modal-body">
                                    <form @submit.prevent="createMember">
                                        <div class="mb-3">
                                            <label class="form-label">用戶名</label>
                                            <input type="text" class="form-control" v-model="newMember.username" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">密碼</label>
                                            <input type="password" class="form-control" v-model="newMember.password" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">確認密碼</label>
                                            <input type="password" class="form-control" v-model="newMember.confirmPassword" required>
                                        </div>
                                        <div class="text-end">
                                            <button type="button" class="btn btn-secondary me-2" @click="hideCreateMemberModal">取消</button>
                                            <button type="submit" class="btn btn-primary" :disabled="loading">
                                                <span v-if="loading" class="spinner-border spinner-border-sm" role="status"></span>
                                                建立
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 會員餘額調整模態框 -->
                    <div class="modal fade" id="adjustBalanceModal" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">點數轉移 - {{ balanceAdjustData.memberUsername }}</h5>
                                    <button type="button" class="btn-close" @click="hideAdjustBalanceModal"></button>
                                </div>
                                <div class="modal-body">
                                    <form @submit.prevent="submitBalanceAdjustment">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label class="form-label">代理餘額</label>
                                                <input type="text" class="form-control" :value="formatMoney(agentCurrentBalance)" disabled>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">會員餘額</label>
                                                <input type="text" class="form-control" :value="formatMoney(balanceAdjustData.currentBalance)" disabled>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">轉移類型</label>
                                            <div class="btn-group w-100">
                                                <input type="radio" class="btn-check" name="transferType" id="deposit" v-model="transferType" value="deposit">
                                                <label class="btn btn-outline-success" for="deposit">存入 (代理→會員)</label>
                                                
                                                <input type="radio" class="btn-check" name="transferType" id="withdraw" v-model="transferType" value="withdraw">
                                                <label class="btn btn-outline-danger" for="withdraw">提領 (會員→代理)</label>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">點數轉移金額</label>
                                            <div class="input-group">
                                                <input type="number" step="0.01" class="form-control" v-model="transferAmount" 
                                                       placeholder="請輸入要轉移的點數金額" min="0" required>
                                                <span class="input-group-text">元</span>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">轉移後會員點數</label>
                                            <input type="text" class="form-control" 
                                                   :value="formatMoney(calculateFinalMemberBalance())" 
                                                   disabled>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">轉移後代理點數</label>
                                            <input type="text" class="form-control" 
                                                   :value="formatMoney(calculateFinalAgentBalance())" 
                                                   disabled>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">備註說明</label>
                                            <textarea class="form-control" v-model="balanceAdjustData.description" 
                                                      placeholder="請輸入點數轉移原因"></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" @click="hideAdjustBalanceModal">取消</button>
                                    <button type="button" class="btn btn-primary" @click="submitBalanceAdjustment" :disabled="!isValidTransfer">
                                        <i class="fas fa-check me-1"></i>確認轉移
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 事務記錄頁面 -->
                <div v-if="activeTab === 'transactions'">
                    <h2>事務記錄</h2>
                    
                    <ul class="nav nav-tabs mb-3">
                        <li class="nav-item">
                            <a class="nav-link" :class="{active: transactionTab === 'deposit'}" href="#" @click="transactionTab = 'deposit'">
                                <i class="fas fa-credit-card me-1"></i>存款記錄
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{active: transactionTab === 'withdraw'}" href="#" @click="transactionTab = 'withdraw'">
                                <i class="fas fa-money-bill-wave me-1"></i>提款記錄
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{active: transactionTab === 'commission'}" href="#" @click="transactionTab = 'commission'">
                                <i class="fas fa-percent me-1"></i>佣金記錄
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{active: transactionTab === 'transfers'}" href="#" @click="loadPointTransfers(); transactionTab = 'transfers'">
                                <i class="fas fa-exchange-alt me-1"></i>點數轉移記錄
                            </a>
                        </li>
                    </ul>
                    
                    <!-- 點數轉移記錄 -->
                    <div v-if="transactionTab === 'transfers'" class="card">
                        <div class="card-header">
                            點數轉移記錄
                            <div class="float-end">
                                <button class="btn btn-sm btn-outline-primary" @click="loadPointTransfers()">
                                    <i class="fas fa-sync me-1"></i>刷新
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th scope="col">編號</th>
                                            <th scope="col">類型</th>
                                            <th scope="col">轉移方向</th>
                                            <th scope="col">金額</th>
                                            <th scope="col">轉出前餘額</th>
                                            <th scope="col">轉出後餘額</th>
                                            <th scope="col">轉入前餘額</th>
                                            <th scope="col">轉入後餘額</th>
                                            <th scope="col">說明</th>
                                            <th scope="col">時間</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="transfer in pointTransfers" :key="transfer.id">
                                            <td>{{ transfer.id }}</td>
                                            <td>{{ formatTransferType(transfer) }}</td>
                                            <td>
                                                <span v-if="transfer.from_type === 'agent' && transfer.from_id === user.id">
                                                    代理 ({{ transfer.from_id }}) → 會員 ({{ transfer.to_id }})
                                                </span>
                                                <span v-else-if="transfer.to_type === 'agent' && transfer.to_id === user.id">
                                                    會員 ({{ transfer.from_id }}) → 代理 ({{ transfer.to_id }})
                                                </span>
                                                <span v-else>
                                                    {{ formatTransferDirection(transfer) }}
                                                </span>
                                            </td>
                                            <td>{{ formatMoney(transfer.amount) }}</td>
                                            <td>{{ formatMoney(transfer.from_before_balance) }}</td>
                                            <td>{{ formatMoney(transfer.from_after_balance) }}</td>
                                            <td>{{ formatMoney(transfer.to_before_balance) }}</td>
                                            <td>{{ formatMoney(transfer.to_after_balance) }}</td>
                                            <td>{{ transfer.description }}</td>
                                            <td>{{ formatDate(transfer.created_at) }}</td>
                                        </tr>
                                        <tr v-if="pointTransfers.length === 0">
                                            <td colspan="10" class="text-center">無點數轉移記錄</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ... other transaction tabs ... -->
                </div>

                <!-- 開獎記錄 -->
                <div v-if="activeTab === 'draw'">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>開獎記錄</h2>
                        <button class="btn btn-primary" @click="loadDrawHistory">
                            <i class="fas fa-sync-alt me-1"></i>刷新
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="row g-2">
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <span class="input-group-text">期數</span>
                                        <input type="text" class="form-control" placeholder="輸入期數查詢" v-model="drawFilters.period">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <span class="input-group-text">日期</span>
                                        <input type="date" class="form-control" v-model="drawFilters.date">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-primary w-100" @click="searchDrawHistory">
                                        <i class="fas fa-search me-1"></i>搜尋
                                    </button>
                                </div>
                                <div class="col-md-2">
                                    <button class="btn btn-secondary w-100" @click="searchTodayDrawHistory">
                                        <i class="fas fa-calendar-day me-1"></i>今日開獎
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>期數</th>
                                            <th>開獎號碼</th>
                                            <th>開獎時間</th>
                                            <th>冠亞軍</th>
                                            <th>龍虎</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="record in drawRecords" :key="record.period">
                                            <td>{{ record.period }}</td>
                                            <td>
                                                <div class="d-flex">
                                                    <span v-for="(num, index) in record.result || []" :key="index"
                                                          class="number-ball mx-1"
                                                          :class="'color-' + num">
                                                        {{ num || '-' }}
                                                    </span>
                                                </div>
                                            </td>
                                            <td>{{ record.draw_time ? formatDate(record.draw_time) : 'N/A' }}</td>
                                            <td v-if="record && record.result && record.result.length >= 2">
                                                <div>冠: {{ record.result[0] > 5 ? '大' : '小' }} {{ record.result[0] % 2 === 0 ? '雙' : '單' }}</div>
                                                <div>亞: {{ record.result[1] > 5 ? '大' : '小' }} {{ record.result[1] % 2 === 0 ? '雙' : '單' }}</div>
                                            </td>
                                            <td v-else><span>-</span></td>
                                            <td>
                                                <span v-if="record && record.result && record.result.length >= 10" 
                                                      :class="{'text-danger': record.result[0] > record.result[9], 'text-primary': record.result[0] < record.result[9]}">
                                                    {{ getDragonTigerResult(record).value }}
                                                </span>
                                                <span v-else>-</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <!-- 無記錄顯示 -->
                                <div v-if="drawRecords.length === 0" class="text-center py-4">
                                    <p class="text-muted">暫無開獎記錄</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 分頁控制 -->
                        <div class="card-footer">
                            <nav v-if="drawPagination.totalPages > 1">
                                <ul class="pagination justify-content-center mb-0">
                                    <li class="page-item" :class="{disabled: drawPagination.currentPage === 1}">
                                        <a class="page-link" href="#" @click.prevent="changePage(1, 'draw')">首頁</a>
                                    </li>
                                    <li class="page-item" :class="{disabled: drawPagination.currentPage === 1}">
                                        <a class="page-link" href="#" @click.prevent="changePage(drawPagination.currentPage - 1, 'draw')">上一頁</a>
                                    </li>
                                    
                                    <li v-for="page in getPageRange(drawPagination.currentPage, drawPagination.totalPages)" 
                                        :key="page" 
                                        class="page-item" 
                                        :class="{active: page === drawPagination.currentPage}">
                                        <a class="page-link" href="#" @click.prevent="changePage(page, 'draw')">{{ page }}</a>
                                    </li>
                                    
                                    <li class="page-item" :class="{disabled: drawPagination.currentPage === drawPagination.totalPages}">
                                        <a class="page-link" href="#" @click.prevent="changePage(drawPagination.currentPage + 1, 'draw')">下一頁</a>
                                    </li>
                                    <li class="page-item" :class="{disabled: drawPagination.currentPage === drawPagination.totalPages}">
                                        <a class="page-link" href="#" @click.prevent="changePage(drawPagination.totalPages, 'draw')">末頁</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- 統計數據 -->
                <div v-if="activeTab === 'stats'">
                    <h2>下注記錄</h2>
                    <div class="card mb-4">
                        <div class="card-header">
                            搜尋條件
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">會員</label>
                                    <select class="form-select" v-model="betFilters.member">
                                        <option value="">全部會員</option>
                                        <option v-for="member in members" :key="member.id" :value="member.username">
                                            {{ member.username }}
                                        </option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">日期</label>
                                    <input type="date" class="form-control" v-model="betFilters.date">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">期數</label>
                                    <input type="text" class="form-control" placeholder="輸入期數" v-model="betFilters.period">
                                </div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <button class="btn btn-primary w-100" @click="searchBets">
                                        <i class="fas fa-search me-1"></i>搜尋
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>會員</th>
                                            <th>期數</th>
                                            <th>投注類型</th>
                                            <th>位置</th>
                                            <th>投注選項</th>
                                            <th>金額</th>
                                            <th>賠率</th>
                                            <th>輸贏</th>
                                            <th>盈虧</th>
                                            <th>時間</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-if="bets.length === 0">
                                            <td colspan="10" class="text-center">暫無下注記錄</td>
                                        </tr>
                                        <tr v-for="bet in bets" :key="bet.id">
                                            <td>{{ bet.username }}</td>
                                            <td>{{ bet.period }}</td>
                                            <td>{{ formatBetType(bet.bet_type) }}</td>
                                            <td>{{ formatPosition(bet.position) }}</td>
                                            <td>{{ bet.bet_value }}</td>
                                            <td>{{ formatMoney(bet.amount) }}</td>
                                            <td>{{ bet.odds }}</td>
                                            <td>
                                                <span v-if="bet.settled" :class="bet.win ? 'text-success' : 'text-danger'">
                                                    {{ bet.win ? '贏' : '輸' }}
                                                </span>
                                                <span v-else class="text-warning">未結算</span>
                                            </td>
                                            <td :class="bet.win ? 'text-success' : 'text-danger'">
                                                {{ formatMoney(bet.win ? bet.win_amount - bet.amount : -bet.amount) }}
                                            </td>
                                            <td>{{ formatDate(bet.created_at) }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <nav v-if="betPagination.totalPages > 1">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item" :class="{disabled: betPagination.currentPage === 1}">
                                        <a class="page-link" href="#" @click.prevent="changePage(betPagination.currentPage - 1, 'bets')">上一頁</a>
                                    </li>
                                    <li class="page-item" v-for="page in getPageRange(betPagination.currentPage, betPagination.totalPages)" :key="page" :class="{active: page === betPagination.currentPage}">
                                        <a class="page-link" href="#" @click.prevent="changePage(page, 'bets')">{{ page }}</a>
                                    </li>
                                    <li class="page-item" :class="{disabled: betPagination.currentPage === betPagination.totalPages}">
                                        <a class="page-link" href="#" @click.prevent="changePage(betPagination.currentPage + 1, 'bets')">下一頁</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header">
                            下注統計信息
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <div class="card bg-primary text-white">
                                        <div class="card-body">
                                            <h5 class="card-title">總投注筆數</h5>
                                            <h2 class="card-text">{{ betStats.totalBets || 0 }}</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="card bg-info text-white">
                                        <div class="card-body">
                                            <h5 class="card-title">總投注金額</h5>
                                            <h2 class="card-text">{{ formatMoney(betStats.totalAmount || 0) }}</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="card" :class="betStats.totalProfit >= 0 ? 'bg-success' : 'bg-danger'">
                                        <div class="card-body text-white">
                                            <h5 class="card-title">會員總盈虧</h5>
                                            <h2 class="card-text">{{ formatMoney(betStats.totalProfit || 0) }}</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <div class="card" :class="betStats.totalProfit < 0 ? 'bg-success' : 'bg-danger'">
                                        <div class="card-body text-white">
                                            <h5 class="card-title">代理收益</h5>
                                            <h2 class="card-text">{{ formatMoney(betStats.totalProfit ? -betStats.totalProfit : 0) }}</h2>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 載入必要的 JS 庫 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- 載入主要 JS 檔案 -->
    <script src="./js/main.js"></script>
</body>
</html>