# 三种状态管理系统 - 测试说明

## 功能概述

已成功为代理管理系统新增三种状态支援：
1. **启用** (status: 1) - 正常可用状态
2. **停用** (status: 0) - 暂时停用状态  
3. **冻结** (status: 2) - 冻结状态

## 全新状态按钮设计 🎨

### 直觉化分割按钮设计
- **左侧按钮**: 显示当前状态（绿色启用/灰色停用/黄色冻结），且为禁用状态，只用于显示
- **右侧下拉箭头**: 提供可选的其他状态选项，排除当前状态

### 状态选择逻辑
```
当前状态：启用 → 下拉选单显示：[设为停用] [设为冻结]
当前状态：停用 → 下拉选单显示：[设为启用] [设为冻结]  
当前状态：冻结 → 下拉选单显示：[设为启用] [设为停用]
```

## 操作流程

### 代理状态更改
1. 在代理列表中找到目标代理
2. 点击状态按钮右侧的下拉箭头
3. 选择要设定的新状态（如：「设为停用」）
4. 确认对话框会显示：「确定要将代理 XXX 设为停用状态吗？」
5. 点击确认后状态立即更新

### 会员状态更改  
1. 在会员列表中找到目标会员
2. 点击状态按钮右侧的下拉箭头
3. 选择要设定的新状态（如：「设为冻结」）
4. 确认对话框会显示：「确定要将会员 XXX 设为冻结状态吗？」
5. 点击确认后状态立即更新

## 视觉效果

### 状态显示按钮（左侧，禁用状态）
- **启用**: 绿色徽章 `bg-success` + ✓ 图标
- **停用**: 灰色徽章 `bg-secondary` + 🚫 图标
- **冻结**: 黄色徽章 `bg-warning text-dark` + ❄️ 图标

### 下拉选单选项（右侧）
- **设为启用**: 绿色勾选图标 + 「设为启用」文字
- **设为停用**: 灰色禁止图标 + 「设为停用」文字
- **设为冻结**: 黄色雪花图标 + 「设为冻结」文字

## 新增的JavaScript函数

### 1. changeAgentStatus(agent, newStatus)
```javascript
// 直接设定代理为指定状态
await changeAgentStatus(agent, 1)  // 设为启用
await changeAgentStatus(agent, 0)  // 设为停用
await changeAgentStatus(agent, 2)  // 设为冻结
```

### 2. changeMemberStatus(member, newStatus)
```javascript
// 直接设定会员为指定状态
await changeMemberStatus(member, 1)  // 设为启用
await changeMemberStatus(member, 0)  // 设为停用
await changeMemberStatus(member, 2)  // 设为冻结
```

### 3. 保留的辅助函数
```javascript
getStatusText(status)        // 返回状态文字
getStatusBadgeClass(status)  // 返回徽章样式类别
getStatusIconClass(status)   // 返回图标类别
```

## HTML模板结构

### 代理状态按钮
```html
<div class="btn-group">
    <!-- 状态显示按钮（禁用） -->
    <button type="button" class="btn btn-sm" :class="getStatusBadgeClass(agent.status)" disabled>
        <i class="fas" :class="getStatusIconClass(agent.status)"></i>
        {{ getStatusText(agent.status) }}
    </button>
    
    <!-- 下拉切换按钮 -->
    <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle dropdown-toggle-split" 
            data-bs-toggle="dropdown" aria-expanded="false">
        <span class="visually-hidden">切换状态</span>
    </button>
    
    <!-- 下拉选单 -->
    <ul class="dropdown-menu">
        <li v-if="agent.status !== 1">
            <a class="dropdown-item" href="#" @click.prevent="changeAgentStatus(agent, 1)">
                <i class="fas fa-check text-success me-2"></i>设为启用
            </a>
        </li>
        <li v-if="agent.status !== 0">
            <a class="dropdown-item" href="#" @click.prevent="changeAgentStatus(agent, 0)">
                <i class="fas fa-ban text-secondary me-2"></i>设为停用
            </a>
        </li>
        <li v-if="agent.status !== 2">
            <a class="dropdown-item" href="#" @click.prevent="changeAgentStatus(agent, 2)">
                <i class="fas fa-snowflake text-warning me-2"></i>设为冻结
            </a>
        </li>
    </ul>
</div>
```

## 测试步骤

### 基本功能测试
1. **检查按钮显示**：确认状态按钮正确显示当前状态和颜色
2. **检查下拉选单**：确认下拉选单只显示可选状态，不包含当前状态
3. **测试状态切换**：尝试将代理/会员设定为不同状态
4. **验证确认对话**：检查确认对话框文字是否正确
5. **检查更新结果**：确认状态更新后界面立即反映变化

### 进阶功能测试
1. **批量测试**：对多个代理/会员进行状态切换
2. **刷新测试**：切换状态后刷新页面，确认状态持久化
3. **权限测试**：确认只有有权限的用户能看到状态切换选项
4. **错误处理**：测试网路错误或伺服器错误时的处理情况

## 兼容性说明

✅ **完全向后兼容**
- 原有的 `toggleAgentStatus()` 和 `toggleMemberStatus()` 函数保留
- 所有现有的状态处理逻辑不变
- 资料库状态值定义不变（1=启用，0=停用，2=冻结）

✅ **UI/UX 大幅改善**
- 解决了原本「启用状态按钮还显示启用」的混淆问题
- 提供清晰直觉的状态设定选项
- 使用Bootstrap标准设计确保美观一致

## 注意事项

1. 需要Bootstrap 5.x支援下拉选单功能
2. 确保前端包含FontAwesome图标库
3. 后端API端点 `/toggle-agent-status` 和 `/toggle-member-status` 需要正常运作
4. 建议定期清理浏览器快取以确保JavaScript更新生效 