# 输赢控制系统手动测试指南

## 🎯 测试目的
验证输赢控制系统的四种模式和不同机率比例控制是否正确实现。

## 📋 测试环境
- **管理端**: http://localhost:3003
- **游戏端**: http://localhost:3000
- **测试帐号**: 
  - 管理员: ti2025A / ti2025A
  - 会员: titi / titi123 (或其他现有会员)

## 🔧 测试准备

### 1. 启动服务
```bash
# 启动代理管理系统
node agentBackend.js

# 启动游戏后端
node backend.js

# 启动游戏前端
npm start
```

### 2. 登录管理端
1. 打开 http://localhost:3003
2. 使用 ti2025A / ti2025A 登录
3. 点击「客服功能」标签
4. 选择「输赢控制」子标签

## 🎮 详细测试步骤

### 测试案例 1: 单会员赢控制 (90%机率)

#### 设定步骤：
1. 在输赢控制界面点击「新增控制」
2. 填写以下设定：
   - **控制模式**: single_member (单会员控制)
   - **目标类型**: member (会员)
   - **目标用户**: 选择 titi
   - **控制机率**: 90%
   - **控制类型**: ☑️ 赢控制 ☐ 输控制
   - **开始期数**: 使用建议期数或手动输入
3. 点击「创建」按钮
4. 在控制列表中点击「激活」按钮

#### 测试步骤：
1. 打开游戏前端 http://localhost:3000
2. 使用会员帐号 titi 登录
3. 连续下注5-10轮，每轮下注100元在相同号码上
4. 观察开奖结果：应该有约90%的机率中奖

#### 预期结果：
- ✅ 会员 titi 的中奖率应接近90%
- ✅ 其他会员不受影响
- ✅ 管理端可正常查看控制状态

### 测试案例 2: 单会员输控制 (10%机率)

#### 设定步骤：
1. 先停用之前的控制设定
2. 创建新控制设定：
   - **控制模式**: single_member
   - **目标用户**: titi
   - **控制机率**: 10%
   - **控制类型**: ☐ 赢控制 ☑️ 输控制

#### 测试步骤：
1. 继续使用会员 titi 下注
2. 连续下注5-10轮
3. 观察开奖结果：应该只有约10%的机率中奖

#### 预期结果：
- ✅ 会员 titi 的中奖率应接近10%
- ✅ 输控制正确生效

### 测试案例 3: 代理线控制 (70%机率)

#### 设定步骤：
1. 创建代理线控制：
   - **控制模式**: agent_line (代理线控制)
   - **目标类型**: agent (代理)
   - **目标用户**: 选择一个有下级会员的代理
   - **控制机率**: 70%
   - **控制类型**: ☑️ 赢控制

#### 测试步骤：
1. 使用该代理线下的多个会员帐号登录游戏
2. 让这些会员同时下注
3. 观察整条代理线的中奖情况

#### 预期结果：
- ✅ 该代理线下所有会员的整体中奖率约70%
- ✅ 其他代理线不受影响

### 测试案例 4: 自动侦测控制 (30%机率)

#### 设定步骤：
1. 创建自动侦测控制：
   - **控制模式**: auto_detect (自动侦测)
   - **目标类型**: 留空
   - **控制机率**: 30%
   - **控制类型**: ☐ 赢控制 ☑️ 输控制

#### 测试步骤：
1. 让多个会员在同一期大额下注（单笔超过1000元）
2. 观察系统是否自动侦测并触发控制
3. 查看开奖结果是否符合设定

#### 预期结果：
- ✅ 大额下注时自动触发控制
- ✅ 中奖率约30%（输控制）
- ✅ 小额下注时不触发控制

## 🔍 机率验证方法

### 统计验证：
1. **短期测试** (10轮)：允许±20%的误差
2. **中期测试** (50轮)：允许±10%的误差  
3. **长期测试** (100轮)：允许±5%的误差

### 记录格式：
```
测试轮数 | 设定机率 | 实际中奖次数 | 实际机率 | 误差
10轮    | 90%     | 8次         | 80%     | -10%
50轮    | 90%     | 47次        | 94%     | +4%
```

## ⚠️ 注意事项

### 测试时机：
- 确保测试期间没有其他会员大量下注
- 控制设定需要在期数开始前设置
- 每个测试案例之间要清理之前的控制设定

### 故障排除：
1. **控制不生效**：检查开始期数是否正确
2. **机率偏差很大**：增加测试轮数
3. **API错误**：检查服务器日志
4. **权限错误**：确认使用总代理帐号登录

## 📊 测试报告模板

```
=== 输赢控制系统测试报告 ===

测试日期: [填写日期]
测试人员: [填写姓名]
测试环境: [本地/生产]

--- 单会员赢控制测试 ---
设定机率: 90%
测试轮数: [轮数]
实际中奖: [次数]
实际机率: [百分比]
结果: [通过/失败]

--- 单会员输控制测试 ---
设定机率: 10%
测试轮数: [轮数]
实际中奖: [次数]
实际机率: [百分比]
结果: [通过/失败]

--- 代理线控制测试 ---
设定机率: 70%
测试轮数: [轮数]
实际中奖: [次数]
实际机率: [百分比]
结果: [通过/失败]

--- 自动侦测控制测试 ---
设定机率: 30%
大额下注触发: [是/否]
测试轮数: [轮数]
实际中奖: [次数]
实际机率: [百分比]
结果: [通过/失败]

--- 总结 ---
整体测试结果: [通过/失败]
发现问题: [列出问题]
改进建议: [列出建议]
```

## 🎯 成功标准

✅ **功能正确性**：
- 所有控制模式都能正确创建和激活
- 机率控制在合理误差范围内
- 不同控制类型互不干扰

✅ **界面可用性**：
- 管理界面操作流畅
- 控制状态显示正确
- 错误信息清晰明确

✅ **系统稳定性**：
- 长时间运行无错误
- 高并发下注时稳定
- 控制切换无异常

---

💡 **建议测试顺序**：单会员控制 → 代理线控制 → 自动侦测控制
🔧 **问题回报**：请记录所有异常情况和错误日志
📈 **持续改进**：根据测试结果调整机率算法和控制逻辑
